<tarta-lotus.html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lotus Overdose - Detalles | NonnaPunk</title>
    
    <script src="https://js.stripe.com/v3/"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- ESTILOS GLOBALES (Id√©nticos al Index) --- */
        :root {
            --color-fondo: #F9F7F2;
            --color-texto: #2C2C2C;
            --color-acento: #FF4757;
            --color-secundario: #ECCC68;
            --color-negro-footer: #1a1a1a;
            --color-lotus: #cd853f; /* Color especial para Lotus */
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Montserrat', sans-serif; background-color: var(--color-fondo); color: var(--color-texto); line-height: 1.6; }
        h1, h2, h3 { font-family: 'Playfair Display', serif; }

        /* Header */
        header {
            background-color: rgba(255, 255, 255, 0.98); padding: 15px 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 1000;
        }
        .header-content { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
        .logo-img { height: 60px; width: auto; }
        nav a { text-decoration: none; color: var(--color-texto); font-weight: 600; margin-left: 20px; transition: 0.3s; }
        nav a:hover { color: var(--color-acento); }

        /* --- DETALLE DEL PRODUCTO --- */
        .container-detalle {
            max-width: 1000px; margin: 60px auto; background: white;
            padding: 50px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.05);
            display: flex; flex-wrap: wrap; gap: 50px; align-items: center; position: relative;
        }

        .btn-volver {
            display: inline-block; margin-bottom: 20px; text-decoration: none;
            color: #666; font-weight: bold; transition: 0.3s;
        }
        .btn-volver:hover { color: var(--color-acento); transform: translateX(-5px); }

        .foto-detalle { flex: 1 1 400px; }
        /* Sombra especial color Lotus */
        .foto-detalle img { width: 100%; border-radius: 15px; box-shadow: 10px 10px 0px var(--color-lotus); }

        .texto-detalle { flex: 1 1 400px; }
        h1 { font-size: 2.8rem; margin-bottom: 10px; line-height: 1.1; }
        .precio-grande { font-size: 2.2rem; color: var(--color-acento); font-weight: bold; display: block; margin-bottom: 20px; }

        .detalles-box {
            background-color: #fffbf2; padding: 20px; border-left: 4px solid var(--color-lotus);
            margin: 25px 0; font-size: 0.95rem; border-radius: 0 10px 10px 0;
        }
        .detalles-box ul { padding-left: 20px; margin-top: 10px; }
        .detalles-box li { margin-bottom: 5px; }

        .btn-pedir {
            display: inline-block; background-color: var(--color-acento); color: white;
            padding: 15px 40px; text-decoration: none; font-weight: bold; border: none;
            border-radius: 50px; margin-top: 20px; cursor: pointer; font-size: 1.1rem;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn-pedir:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(255, 71, 87, 0.3); }

        /* --- CARRITO Y MODALES (Copiados del Index) --- */
        .cart-button { position: fixed; bottom: 30px; right: 30px; background: var(--color-acento); color: white; width: 65px; height: 65px; border-radius: 50%; border: none; font-size: 24px; cursor: pointer; box-shadow: 0 4px 20px rgba(255, 71, 87, 0.5); z-index: 999; transition: transform 0.3s; display: flex; align-items: center; justify-content: center; }
        .cart-button:hover { transform: scale(1.1); }
        .cart-count { position: absolute; top: -5px; right: -5px; background: var(--color-secundario); color: var(--color-texto); width: 25px; height: 25px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; border: 2px solid white; }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); z-index: 2000; align-items: center; justify-content: center; animation: fadeIn 0.3s; }
        .modal.active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .modal-content { background: white; padding: 40px; border-radius: 20px; max-width: 550px; width: 90%; max-height: 90vh; overflow-y: auto; position: relative; animation: slideUp 0.3s; }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .close-modal { position: absolute; top: 20px; right: 20px; background: none; border: none; font-size: 30px; cursor: pointer; color: #999; }
        
        .cart-item { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid #eee; }
        .btn-remove { background: rgba(255, 71, 87, 0.1); color: var(--color-acento); border: none; padding: 5px 12px; border-radius: 6px; cursor: pointer; margin-left: 10px; font-weight: bold; }
        .cart-total { font-size: 1.5rem; font-weight: bold; color: var(--color-texto); margin: 25px 0; text-align: right; border-top: 2px solid #eee; padding-top: 15px; }

        /* Formulario */
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.9rem; }
        .form-group input, .form-group textarea { width: 100%; padding: 12px; border: 2px solid #eee; border-radius: 10px; font-family: 'Montserrat', sans-serif; font-size: 16px; }
        #card-element { padding: 15px; border: 2px solid #eee; border-radius: 10px; background: white; }
        .spinner { border: 3px solid rgba(255,255,255,0.3); border-radius: 50%; border-top: 3px solid white; width: 24px; height: 24px; animation: spin 1s linear infinite; display: inline-block; vertical-align: middle; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Footer */
        footer { background: var(--color-negro-footer); color: #ccc; padding: 60px 20px; margin-top: 80px; text-align: center; }
        .footer-content { max-width: 1200px; margin: 0 auto; display: flex; justify-content: center; gap: 40px; flex-wrap: wrap; }
        .footer-col { max-width: 300px; text-align: left; }
        .footer-col h3 { color: white; margin-bottom: 15px; }
    </style>
</head>
<body>

    <header>
        <div class="header-content">
            <a href="index.html"><img src="logo.png" alt="Logo NonnaPunk" class="logo-img"></a>
            <nav>
                <a href="index.html#menu">Volver al Men√∫</a>
                <a href="index.html#merch">Merch</a>
            </nav>
        </div>
    </header>

    <button class="cart-button" onclick="toggleCart()">
        üõí <span class="cart-count" id="cartCount">0</span>
    </button>

    <div class="modal" id="cartModal">
        <div class="modal-content">
            <button class="close-modal" onclick="toggleCart()">√ó</button>
            <h2>Tu Carrito Punk</h2>
            <div id="cartItems"></div>
            <div class="cart-total">Total: <span id="cartTotal">0.00‚Ç¨</span></div>
            <button class="btn-pedir" style="width: 100%; margin:0;" onclick="proceedToCheckout()">Proceder al Pago</button>
        </div>
    </div>

    <div class="modal" id="checkoutModal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeCheckout()">√ó</button>
            
            <div id="checkoutContent">
                <h2>Finalizar Pedido</h2>
                <div id="orderSummary" style="background:#f9f9f9; padding:15px; border-radius:10px; margin-bottom:20px;"></div>
                
                <form id="payment-form">
                    <div class="form-group"><label>Nombre</label><input type="text" id="customer-name" required></div>
                    <div class="form-group"><label>Email</label><input type="email" id="customer-email" required></div>
                    <div class="form-group"><label>Tel√©fono</label><input type="tel" id="customer-phone" required></div>
                    <div class="form-group"><label>Fecha Recogida</label><input type="date" id="pickup-date" required></div>
                    <div class="form-group"><label>Notas / Alergias</label><textarea id="customer-notes" rows="2"></textarea></div>
                    
                    <div class="form-group">
                        <label>Tarjeta (Stripe Seguro)</label>
                        <div id="card-element"></div>
                        <div id="card-errors" style="color:red; margin-top:5px;"></div>
                    </div>
                    
                    <button type="submit" id="submit-button" class="btn-pedir" style="width: 100%;">
                        <span id="button-text">PAGAR AHORA</span>
                        <div id="spinner" class="spinner" style="display: none;"></div>
                    </button>
                </form>
            </div>
            
            <div id="success-message" style="display: none; text-align: center;">
                <div style="font-size: 60px;">‚úÖ</div>
                <h3>¬°Pedido Confirmado!</h3>
                <p>Referencia: <span id="order-number" style="font-weight:bold;"></span></p>
                <p>Enviado a: <span id="confirm-email"></span></p>
            </div>
        </div>
    </div>

    <div class="container-detalle">
        <a href="index.html" class="btn-volver">‚Üê Volver al Men√∫</a>
        
        <div class="foto-detalle">
            <img src="lotus.png" alt="Tarta Lotus Grande">
        </div>

        <div class="texto-detalle">
            <h1>Lotus Biscoff Overdose</h1>
            <span class="precio-grande">28.00‚Ç¨</span>
            
            <p>¬øSutil? No conocemos esa palabra en NonnaPunk.</p>
            
            <p>Hemos cogido la galleta m√°s adictiva del planeta y la hemos convertido en una tarta que deber√≠a ser ilegal. Esto no es un postre, es una declaraci√≥n de intenciones.</p>

            <div class="detalles-box">
                <strong>üç™ Ficha T√©cnica de la Adicci√≥n:</strong><br>
                <ul>
                    <li><strong>Base:</strong> Lotus triturada y mantequilla.</li>
                    <li><strong>Relleno:</strong> Queso crema con crema de untar Lotus.</li>
                    <li><strong>Cobertura:</strong> Drip de Lotus fundida y galleta entera.</li>
                    <li><strong>Formato:</strong> 8-10 porciones generosas.</li>
                </ul>
            </div>

            <p><em>*Advertencia: Altamente adictiva. No nos hacemos responsables.</em></p>

            <button class="btn-pedir" onclick="addToCart('Lotus Overdose', 28)">A√ëADIR A LA CESTA</button>
        </div>
    </div>

    <footer>
        <div class="footer-content">
            <div class="footer-col">
                <h3>NonnaPunk</h3>
                <p>Reposter√≠a artesanal con actitud en Toledo.</p>
            </div>
            <div class="footer-col">
                <h3>Contacto</h3>
                <p>üìç Calle Rebeli√≥n, 12</p>
                <p>hola@nonnapunk.com</p>
            </div>
        </div>
        <p style="margin-top:30px; font-size:0.8rem;">¬© 2025 NonnaPunk. Powered by Stripe & Zapier.</p>
    </footer>

    <script>
        const CONFIG = {
            STRIPE_KEY: 'pk_test_51SqafBPfC2lL6XQld47q2pIqeZNRTVo2AH7OPDhOwn67Wb5rRH4iejHkTtbfflnmmVwLUJvfJyp9OXaXwqAIfnB200I6jqATf3', 
            ZAPIER_URL: 'https://hooks.zapier.com/hooks/catch/25982070/ugpz72v/' 
        };

        let cart = JSON.parse(localStorage.getItem('nonnaCart_v2')) || [];

        window.addToCart = function(name, price) {
            const existing = cart.find(item => item.name === name);
            if(existing) { existing.qty++; } else { cart.push({ name, price, qty: 1 }); }
            updateCartUI();
            toggleCart(); // Abrimos carrito al a√±adir
        };

        window.removeFromCart = function(index) {
            cart.splice(index, 1);
            updateCartUI();
        };

        function updateCartUI() {
            localStorage.setItem('nonnaCart_v2', JSON.stringify(cart));
            const totalQty = cart.reduce((sum, item) => sum + item.qty, 0);
            document.getElementById('cartCount').innerText = totalQty;

            const list = document.getElementById('cartItems');
            list.innerHTML = '';
            let total = 0;

            if(cart.length === 0) {
                list.innerHTML = '<p style="color:#999; text-align:center;">Carrito vac√≠o</p>';
            } else {
                cart.forEach((item, idx) => {
                    total += item.price * item.qty;
                    list.innerHTML += `
                        <div class="cart-item">
                            <div><strong>${item.name}</strong><br><small>${item.qty} x ${item.price}‚Ç¨</small></div>
                            <div><strong>${(item.price * item.qty).toFixed(2)}‚Ç¨</strong> <button class="btn-remove" onclick="removeFromCart(${idx})">√ó</button></div>
                        </div>`;
                });
            }
            document.getElementById('cartTotal').innerText = total.toFixed(2) + '‚Ç¨';
        }

        updateCartUI();

        // Modales
        window.toggleCart = function() { document.getElementById('cartModal').classList.toggle('active'); };
        window.closeCheckout = function() { document.getElementById('checkoutModal').classList.remove('active'); };
        
        window.proceedToCheckout = function() {
            if(cart.length === 0) return alert("Carrito vac√≠o");
            toggleCart();
            document.getElementById('checkoutModal').classList.add('active');
            
            const total = cart.reduce((sum, item) => sum + (item.price * item.qty), 0);
            document.getElementById('orderSummary').innerHTML = `<strong>Total: ${total.toFixed(2)}‚Ç¨</strong>`;
            document.getElementById('button-text').innerText = `PAGAR ${total.toFixed(2)}‚Ç¨`;
            
            const tmr = new Date(); tmr.setDate(tmr.getDate()+1);
            document.getElementById('pickup-date').min = tmr.toISOString().split('T')[0];
            
            initStripe();
        };

        // Stripe Logic
        let stripe, elements, card;
        function initStripe() {
            if(stripe) return;
            stripe = Stripe(CONFIG.STRIPE_KEY);
            elements = stripe.elements();
            card = elements.create('card', { style: { base: { fontSize: '16px', fontFamily: 'Montserrat' } } });
            card.mount('#card-element');
            card.on('change', ({error}) => document.getElementById('card-errors').textContent = error ? error.message : '');
        }

        document.getElementById('payment-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('submit-button');
            const spinner = document.getElementById('spinner');
            const txt = document.getElementById('button-text');
            
            btn.disabled = true; txt.style.display = 'none'; spinner.style.display = 'inline-block';

            const data = {
                nombre: document.getElementById('customer-name').value,
                email: document.getElementById('customer-email').value,
                telefono: document.getElementById('customer-phone').value,
                fecha: document.getElementById('pickup-date').value,
                notas: document.getElementById('customer-notes').value,
                carrito: cart,
                total: document.getElementById('cartTotal').innerText
            };

            try {
                const {token, error} = await stripe.createToken(card);
                if(error) throw new Error(error.message);

                await fetch(CONFIG.ZAPIER_URL, {
                    method: 'POST', mode: 'no-cors', 
                    headers: {'Content-Type': 'application/json'}, body: JSON.stringify(data)
                });

                await new Promise(r => setTimeout(r, 1500));
                
                document.getElementById('checkoutContent').style.display = 'none';
                document.getElementById('success-message').style.display = 'block';
                document.getElementById('order-number').innerText = "NP-" + Math.floor(Math.random()*10000);
                document.getElementById('confirm-email').innerText = data.email;
                cart = []; updateCartUI();

            } catch(err) {
                alert("Error: " + err.message);
                btn.disabled = false; txt.style.display = 'inline'; spinner.style.display = 'none';
            }
        });
    </script>
</body>
</html>